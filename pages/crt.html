<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>CRT Shader Ref</title>
<style>
  html,body{margin:0;height:100%;background:#07090c;}
  canvas{width:100%;height:100%;display:block;}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const c = document.getElementById('c');
const ctx = c.getContext('2d');
const img = new Image(); img.src = '../assets/sample.png';

function resize(){
  c.width = Math.min(960, window.innerWidth);
  c.height = Math.min(540, window.innerHeight);
}
window.addEventListener('resize', resize); resize();

function draw(){
  const w = c.width, h = c.height;
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle = '#0a0c10';
  ctx.fillRect(0,0,w,h);

  if(img.complete){
    const s = Math.min(w,h)*0.8;
    const x = (w-s)/2, y = (h-s)/2;

    ctx.save();
    ctx.translate(w/2,h/2);
    ctx.scale(1.02,1.02);
    ctx.drawImage(img, -s/2, -s/2, s, s);
    ctx.restore();

    // RGB split glow
    ctx.globalCompositeOperation = 'screen';
    ctx.globalAlpha = 0.16;
    ctx.drawImage(img, x+2, y, s, s);
    ctx.globalAlpha = 0.12;
    ctx.drawImage(img, x-2, y, s, s);
    ctx.globalAlpha = 1.0;
    ctx.globalCompositeOperation = 'source-over';
  }

  // scanlines
  ctx.globalAlpha = 0.22;
  ctx.fillStyle = '#000';
  for(let y=0;y<h;y+=2){ ctx.fillRect(0,y,w,1); }
  ctx.globalAlpha = 1.0;

  // shadow mask (triad)
  ctx.globalCompositeOperation = 'multiply';
  for(let x=0;x<w;x+=3){
    ctx.fillStyle = 'rgba(255,0,0,0.08)'; ctx.fillRect(x,0,1,h);
    ctx.fillStyle = 'rgba(0,255,0,0.06)'; ctx.fillRect(x+1,0,1,h);
    ctx.fillStyle = 'rgba(0,0,255,0.07)'; ctx.fillRect(x+2,0,1,h);
  }
  ctx.globalCompositeOperation = 'source-over';

  // vignette
  const g = ctx.createRadialGradient(w*0.5,h*0.5,Math.min(w,h)*0.2,w*0.5,h*0.5,Math.min(w,h)*0.75);
  g.addColorStop(0,'rgba(0,0,0,0)');
  g.addColorStop(1,'rgba(0,0,0,0.55)');
  ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

  requestAnimationFrame(draw);
}
requestAnimationFrame(draw);
</script>
</body>
</html>
